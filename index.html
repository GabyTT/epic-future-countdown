<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Epic Future Countdown</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont,
                         "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            color: #444;
        }

        h2 {
            text-align: left;
            font-weight: 600;
            margin-bottom: 6px;
        }

        /* ---- Briefing ---- */
        .briefing {
            margin: 6px 0 14px 0;
            opacity: 0;
            transition: opacity 1.2s ease;
        }

        .briefing.show {
            opacity: 1;
        }

        .briefing-title {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 2px;
        }

        .briefing-body {
            font-size: 13px;
            line-height: 1.4;
        }
    </style>
</head>

<body>

<h2 id="header">Epic Future Countdown</h2>

<div id="briefing" class="briefing"></div>

<canvas id="timeChart" width="800" height="400"></canvas>

<script>
    /* ------------------ Messaging Logic ------------------ */

    function getBriefingData() {
        const now = new Date();
        const day = now.getDay(); // 0 = Sun
        const today = now.getDate();
        const daysInMonth = new Date(
            now.getFullYear(),
            now.getMonth() + 1,
            0
        ).getDate();

        const isWeekClosing = (day === 5 || day === 6 || day === 0); // Friâ€“Sun
        const isMonthClosing = today > (daysInMonth - 5);

        // Week closing has priority
        if (isWeekClosing) {
            return {
                color: '#53959F', // Week blue
                html: `
                    <div class="briefing-title">Week closing.</div>
                    <div class="briefing-body">
                        Reconnect with the Future Memory for your active missions.<br>
                        Plan your next small wins.
                    </div>
                `
            };
        }

        if (isMonthClosing) {
            const monthName = now.toLocaleString('default', { month: 'long' });
            return {
                color: '#F9B97F', // Month yellow
                html: `
                    <div class="briefing-title">${monthName} is closing.</div>
                    <div class="briefing-body">
                        Go back to your Future Self Intel.<br>
                        Plan your next milestones.
                    </div>
                `
            };
        }

        return null;
    }

    function updateBriefing() {
        const briefingEl = document.getElementById('briefing');
        const headerEl = document.getElementById('header');
        const data = getBriefingData();

        if (!data) {
            briefingEl.classList.remove('show');
            headerEl.style.display = 'block';
            return;
        }

        headerEl.style.display = 'none';
        briefingEl.classList.remove('show');

        setTimeout(() => {
            briefingEl.innerHTML = data.html;
            briefingEl.style.color = data.color;
            briefingEl.classList.add('show');
        }, 300);
    }

    updateBriefing();
    setInterval(updateBriefing, 60 * 60 * 1000); // hourly refresh

    /* ------------------ Chart Logic (UNCHANGED) ------------------ */

    function getTimePercentages() {
        const now = new Date();

        const elapsedDay = (now.getHours() / 24) * 100;

        const elapsedDaysWeek = (now.getDay() + 6) % 7;
        const elapsedWeek = (elapsedDaysWeek / 7) * 100;

        const daysInMonth = new Date(
            now.getFullYear(),
            now.getMonth() + 1,
            0
        ).getDate();
        const elapsedMonth = (now.getDate() / daysInMonth) * 100;

        const currentQuarter = Math.floor(now.getMonth() / 3);
        const startOfQuarter = new Date(now.getFullYear(), currentQuarter * 3, 1);
        const endOfQuarter = new Date(now.getFullYear(), currentQuarter * 3 + 3, 0);
        const totalWeeksQuarter = Math.ceil((endOfQuarter - startOfQuarter) / (1000 * 60 * 60 * 24 * 7));
        const elapsedWeeksQuarter = Math.floor((now - startOfQuarter) / (1000 * 60 * 60 * 24 * 7));
        const elapsedQuarter = (elapsedWeeksQuarter / totalWeeksQuarter) * 100;

        const elapsedYear = ((now.getMonth() + 1) / 12) * 100;

        return {
            elapsed: [
                elapsedDay,
                elapsedWeek,
                elapsedMonth,
                elapsedQuarter,
                elapsedYear
            ],
            remaining: [
                100 - elapsedDay,
                100 - elapsedWeek,
                100 - elapsedMonth,
                100 - elapsedQuarter,
                100 - elapsedYear
            ]
        };
    }

    const ctx = document.getElementById('timeChart').getContext('2d');
    let percentages = getTimePercentages();

    const timeChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['Day', 'Week', 'Month', 'Quarter', 'Year'],
            datasets: [
                {
                    data: percentages.elapsed,
                    backgroundColor: [
                        '#A7BA93',
                        '#53959F',
                        '#F9B97F',
                        '#F4C2C2',
                        '#C4B8E7'
                    ],
                    borderRadius: { topLeft: 20, bottomLeft: 20 },
                    borderSkipped: false
                },
                {
                    data: percentages.remaining,
                    backgroundColor: 'rgba(211,211,211,0.6)',
                    borderRadius: { topRight: 20, bottomRight: 20 },
                    borderSkipped: false
                }
            ]
        },
        options: {
            indexAxis: 'y',
            responsive: true,
            scales: {
                x: {
                    stacked: true,
                    display: false,
                    max: 100
                },
                y: {
                    stacked: true,
                    ticks: {
                        font: { size: 14, weight: 'bold' },
                        color: '#555'
                    }
                }
            },
            plugins: {
                legend: { display: false }
            }
        }
    });

    setInterval(() => {
        percentages = getTimePercentages();
        timeChart.data.datasets[0].data = percentages.elapsed;
        timeChart.data.datasets[1].data = percentages.remaining;
        timeChart.update();
    }, 60000);
</script>

</body>
</html>

