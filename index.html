<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Epic Future Countdown</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont,
                         "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            color: #444;
        }

        h2 {
            text-align: left;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .briefing {
            margin: 6px 0 14px 0;
            opacity: 0;
            transition: opacity 1.2s ease;
        }

        .briefing.show {
            opacity: 1;
        }

        .briefing-title {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 2px;
        }

        .briefing-body {
            font-size: 13px;
            line-height: 1.4;
        }
    </style>
</head>

<body>

<h2 id="header">Epic Future Countdown</h2>
<div id="briefing" class="briefing"></div>

<canvas id="timeChart" width="800" height="400"></canvas>

<script>
/* ------------------ Messaging Logic (unchanged) ------------------ */

function getBriefingData() {
    const now = new Date();
    const day = now.getDay();
    const today = now.getDate();
    const daysInMonth = new Date(now.getFullYear(), now.getMonth() + 1, 0).getDate();

    const isWeekClosing = (day === 5 || day === 6 || day === 0);
    const isMonthClosing = today > (daysInMonth - 5);

    if (isWeekClosing) {
        return {
            color: '#53959F',
            html: `
                <div class="briefing-title">Week closing.</div>
                <div class="briefing-body">
                    Reconnect with the Future Memory for your active missions.<br>
                    Plan your next small wins.
                </div>
            `
        };
    }

    if (isMonthClosing) {
        const monthName = now.toLocaleString('default', { month: 'long' });
        return {
            color: '#F9B97F',
            html: `
                <div class="briefing-title">${monthName} is closing.</div>
                <div class="briefing-body">
                    Go back to your Future Self Intel.<br>
                    Plan your next milestones.
                </div>
            `
        };
    }

    return null;
}

function updateBriefing() {
    const briefingEl = document.getElementById('briefing');
    const headerEl = document.getElementById('header');
    const data = getBriefingData();

    if (!data) {
        briefingEl.classList.remove('show');
        headerEl.style.display = 'block';
        return;
    }

    headerEl.style.display = 'none';
    briefingEl.classList.remove('show');

    setTimeout(() => {
        briefingEl.innerHTML = data.html;
        briefingEl.style.color = data.color;
        briefingEl.classList.add('show');
    }, 300);
}

updateBriefing();
setInterval(updateBriefing, 60 * 60 * 1000);

/* ------------------ Time Calculations (UNIT-BASED) ------------------ */

function getTimeData() {
    const now = new Date();

    // Day (hours)
    const elapsedHoursDay = now.getHours();
    const remainingHoursDay = 24 - elapsedHoursDay;

    // Week (days, Mon–Sun)
    const elapsedDaysWeek = (now.getDay() + 6) % 7;
    const remainingDaysWeek = 7 - elapsedDaysWeek;

    // Month (days)
    const daysInMonth = new Date(now.getFullYear(), now.getMonth() + 1, 0).getDate();
    const elapsedDaysMonth = now.getDate();
    const remainingDaysMonth = daysInMonth - elapsedDaysMonth;

    // Quarter (weeks)
    const currentQuarter = Math.floor(now.getMonth() / 3);
    const startOfQuarter = new Date(now.getFullYear(), currentQuarter * 3, 1);
    const endOfQuarter = new Date(now.getFullYear(), currentQuarter * 3 + 3, 0);
    const totalWeeksQuarter = Math.ceil((endOfQuarter - startOfQuarter) / (1000 * 60 * 60 * 24 * 7));
    const elapsedWeeksQuarter = Math.floor((now - startOfQuarter) / (1000 * 60 * 60 * 24 * 7));
    const remainingWeeksQuarter = totalWeeksQuarter - elapsedWeeksQuarter;

    // Year (months)
    const elapsedMonthsYear = now.getMonth() + 1;
    const remainingMonthsYear = 12 - elapsedMonthsYear;

    return {
        elapsedPercent: [
            (elapsedHoursDay / 24) * 100,
            (elapsedDaysWeek / 7) * 100,
            (elapsedDaysMonth / daysInMonth) * 100,
            (elapsedWeeksQuarter / totalWeeksQuarter) * 100,
            (elapsedMonthsYear / 12) * 100
        ],
        remainingPercent: [
            100 - (elapsedHoursDay / 24) * 100,
            100 - (elapsedDaysWeek / 7) * 100,
            100 - (elapsedDaysMonth / daysInMonth) * 100,
            100 - (elapsedWeeksQuarter / totalWeeksQuarter) * 100,
            100 - (elapsedMonthsYear / 12) * 100
        ],
        tooltips: [
            `${elapsedHoursDay}h elapsed · ${remainingHoursDay}h remaining`,
            `${elapsedDaysWeek}d elapsed · ${remainingDaysWeek}d remaining`,
            `${elapsedDaysMonth}d elapsed · ${remainingDaysMonth}d remaining`,
            `${elapsedWeeksQuarter}w elapsed · ${remainingWeeksQuarter}w remaining`,
            `${elapsedMonthsYear}m elapsed · ${remainingMonthsYear}m remaining`
        ]
    };
}

/* ------------------ Chart ------------------ */

const ctx = document.getElementById('timeChart').getContext('2d');
let timeData = getTimeData();

const chart = new Chart(ctx, {
    type: 'bar',
    data: {
        labels: ['Day', 'Week', 'Month', 'Quarter', 'Year'],
        datasets: [
            {
                data: timeData.elapsedPercent,
                backgroundColor: ['#A7BA93','#53959F','#F9B97F','#F4C2C2','#C4B8E7'],
                borderRadius: { topLeft: 20, bottomLeft: 20 },
                borderSkipped: false
            },
            {
                data: timeData.remainingPercent,
                backgroundColor: 'rgba(211,211,211,0.6)',
                borderRadius: { topRight: 20, bottomRight: 20 },
                borderSkipped: false
            }
        ]
    },
    options: {
        indexAxis: 'y',
        scales: {
            x: { stacked: true, display: false, max: 100 },
            y: {
                stacked: true,
                ticks: { font: { size: 14, weight: 'bold' }, color: '#555' }
            }
        },
        plugins: {
            legend: { display: false },
            tooltip: {
                callbacks: {
                    label: ctx => timeData.tooltips[ctx.dataIndex]
                }
            }
        }
    }
});

setInterval(() => {
    timeData = getTimeData();
    chart.data.datasets[0].data = timeData.elapsedPercent;
    chart.data.datasets[1].data = timeData.remainingPercent;
    chart.update();
}, 60000);
</script>

</body>
</html>


